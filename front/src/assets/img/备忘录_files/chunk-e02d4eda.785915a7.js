(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e02d4eda"],{"58a8":function(e,t,n){"use strict";var a=n("93a4"),r=n.n(a);r.a},"73bd":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"memorandum-wrapper list-wrapper"},[n("div",{staticClass:"conditions-wrapper mgb-20"},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"MEMORANDUMADD",expression:"'MEMORANDUMADD'"}],staticClass:"mgr-20",attrs:{type:"primary",size:"small"},nativeOn:{click:function(t){return e.handleAddItem(t)}}},[e._v(e._s(e.$t("menuList.新增事件")))]),n("el-date-picker",{staticClass:"w-240 mgr-20",attrs:{type:"daterange","start-placeholder":e.$t("Memerandum.开始日期"),"end-placeholder":e.$t("Memerandum.结束日期"),size:"small","picker-options":e.pickerOptions},on:{change:e.timePickerChange},model:{value:e.timeRange,callback:function(t){e.timeRange=t},expression:"timeRange"}}),e.tagEnum.length?n("el-select",{staticClass:"w-120",attrs:{size:"small",filterable:"",clearable:"",placeholder:e.$t("Memerandum.请选择")},on:{change:e.tagChange},model:{value:e.params.tag,callback:function(t){e.$set(e.params,"tag",t)},expression:"params.tag"}},e._l(e.tagEnum,(function(e){return n("el-option",{key:e,attrs:{size:"small",label:e,value:e}})})),1):e._e(),n("span",{staticClass:"self-adaption"}),n("SearchBar",{staticClass:"search-bar w-240",attrs:{placeholder:"Desc"},on:{sureKeyword:e.sureKeyword},model:{value:e.params.keyword,callback:function(t){e.$set(e.params,"keyword",t)},expression:"params.keyword"}})],1),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"table-wrapper"},[n("el-table",{attrs:{data:e.list,border:"",stripe:"",height:"100%","row-class-name":e.tableRowClassName}},[n("el-table-column",{attrs:{label:e.$t("Memerandum.Order"),width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1)+" ")]}}])}),n("el-table-column",{attrs:{label:e.$t("Memerandum.CreatedTime"),width:"170",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("createdTimeFilters")(t.row.createdTime))+" ")]}}])}),n("el-table-column",{attrs:{prop:"desc",label:e.$t("Memerandum.Desc"),align:"center"}}),n("el-table-column",{attrs:{label:e.$t("Memerandum.Tags"),width:"240",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.tag,(function(t,a){return n("span",{key:t.id},[n("el-tag",{staticClass:"tags",attrs:{effect:"dark",size:"small",type:e.tagType(a)}},[e._v(e._s(t))])],1)}))}}])}),e.$hasPermission("MEMORANDUMCHECK,MEMORANDUMEDIT,MEMORANDUMDELETE,MEMORANDUMSETFIRST")?n("el-table-column",{attrs:{label:e.$t("Memerandum.Operation"),width:"350",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"MEMORANDUMCHECK",expression:"'MEMORANDUMCHECK'"}],attrs:{type:"success",size:"mini"},nativeOn:{click:function(n){return e.hanldeCheck(t.row.content)}}},[e._v(e._s(e.$t("menuList.查看")))]),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"MEMORANDUMEDIT",expression:"'MEMORANDUMEDIT'"}],attrs:{type:"info",size:"mini"},nativeOn:{click:function(n){return e.hanldeEdit(t.row._id)}}},[e._v(e._s(e.$t("menuList.Edit")))]),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"MEMORANDUMDELETE",expression:"'MEMORANDUMDELETE'"}],attrs:{type:"danger",size:"mini"},nativeOn:{click:function(n){return e.hanldeDelete(t.row._id)}}},[e._v(e._s(e.$t("menuList.Delete")))]),t.row.isSetFirst?n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"MEMORANDUMSETFIRST",expression:"'MEMORANDUMSETFIRST'"}],attrs:{type:"warning",size:"mini"},nativeOn:{click:function(n){return e.handleSwitchSetFirst(t.row)}}},[e._v(e._s(e.$t("Memerandum.取消置顶")))]):n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"MEMORANDUMSETFIRST",expression:"'MEMORANDUMSETFIRST'"}],attrs:{type:"warning",size:"mini"},nativeOn:{click:function(n){return e.handleSwitchSetFirst(t.row)}}},[e._v(e._s(e.$t("Memerandum.设为置顶")))])]}}],null,!1,1986290980)}):e._e()],1)],1),n("div",{staticClass:"pagination-wrapper mgt-20"},[n("el-pagination",{attrs:{size:"small","current-page":e.params.page,"page-sizes":[20,30,50],"page-size":e.params.size,layout:"total, sizes, prev, pager, next, jumper",total:e.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),n("memorandumAddDialog",{attrs:{memorandumAddDialog:e.memorandumAddDialog,id:e.id},on:{closeDialog:e.closeDialog}}),n("MemorandumPreviewDrawer",{attrs:{memorandumPreviewDrawer:e.memorandumPreviewDrawer,editorContent:e.editorContent},on:{closeMemorandumPreview:e.closeMemorandumPreview}})],1)},r=[],i=(n("1a8c"),n("3a20"),n("b3f9"),n("3e5e"),n("63ff"),n("34fe")),s=n("2f14"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-dialog",{staticClass:"memorandum-dialog",attrs:{title:e.dialogTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,"modal-append-to-body":"","append-to-body":"",visible:e.memorandumAddDialog,width:"800px","before-close":e.closeDialog},on:{"update:visible":function(t){e.memorandumAddDialog=t},open:e.openDialog}},[n("el-form",{ref:"form",staticClass:"form",attrs:{model:e.model,rules:e.rules,"label-width":"96px","label-position":"left"}},[n("el-form-item",{attrs:{size:"small",label:e.$t("Memerandum.Dialog.事件描述")+":",prop:"desc"}},[n("el-input",{attrs:{size:"small",placeholder:"事件描述"},model:{value:e.model.desc,callback:function(t){e.$set(e.model,"desc",t)},expression:"model.desc"}})],1),n("el-form-item",{attrs:{size:"small",label:e.$t("Memerandum.Dialog.事件Tags")+":",prop:"tag"}},[e._l(e.model.tag,(function(t,a){return n("el-tag",{key:t,attrs:{type:e.tagType(a),closable:"","disable-transitions":!1},on:{close:function(n){return e.handleClose(t)}}},[e._v(" "+e._s(t)+" ")])})),e.inputVisible?n("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):e._e(),n("el-button",{staticClass:"button-new-tag",attrs:{disabled:e.model.tag.length>=3,size:"small"},on:{click:e.showInput}},[e._v(e._s(e.model.tag.length>=3?this.$t("Memerandum.Dialog.最大标签数"):this.$t("Memerandum.Dialog.新增标签")))])],2),n("el-form-item",{attrs:{size:"small",label:e.$t("Memerandum.Dialog.事件内容")+":",prop:"contentText"}},[n("Editor",{ref:"editor",attrs:{id:"editor",params:{directory:"record"},menus:e.menus},on:{editorChange:e.editorChange}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.model.contentText?n("el-button",{attrs:{size:"small",type:"info"},nativeOn:{click:function(t){return e.handlePreview(t)}}},[e._v(e._s(e.$t("Memerandum.Dialog.预览")))]):e._e(),n("el-button",{attrs:{size:"small"},on:{click:function(t){return e.closeDialog(!1)}}},[e._v(e._s(e.$t("Memerandum.Dialog.取消")))]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleSave("form")}}},[e._v(e._s(e.$t("Memerandum.Dialog.确定")))])],1)],1),n("MemorandumPreviewDrawer",{attrs:{memorandumPreviewDrawer:e.memorandumPreviewDrawer,editorContent:e.editorContent},on:{closeMemorandumPreview:e.closeMemorandumPreview}})],1)},u=[],m=(n("a677"),n("4045"),n("e90c"),n("c1b0"),n("3547"),n("1243")),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-drawer",{staticClass:"memorandum-previewer",attrs:{"append-to-body":"","close-on-press-escape":!1,"modal-append-to-body":!1,visible:e.memorandumPreviewDrawer,direction:"rtl","before-close":e.closeMemorandumPreview,size:"800px",withHeader:!1,"destroy-on-close":""},on:{"update:visible":function(t){e.memorandumPreviewDrawer=t},opened:e.openMemorandumPreview}},[e.memorandumPreviewDrawer?n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoaded,expression:"isLoaded"},{name:"viewer",rawName:"v-viewer"}],ref:"previewer",staticClass:"preview-content"}):e._e()])},d=[],c={name:"MemorandumPreviewDrawer",components:{},props:{memorandumPreviewDrawer:{type:Boolean,default:!1},editorContent:{type:String,default:""}},data:function(){return{isLoaded:!0}},computed:{},methods:{openMemorandumPreview:function(){var e=this;this.isLoaded=!1,this.$refs.previewer.innerHTML=this.editorContent,this.$highlight(this.$refs.previewer,(function(){e.isLoaded=!0}))},closeMemorandumPreview:function(){this.$emit("closeMemorandumPreview")}},created:function(){},mounted:function(){},watch:{}},p=c,h=(n("f7b6"),n("5511")),f=Object(h["a"])(p,l,d,!1,null,"7c1e92b9",null),g=f.exports,w={name:"memorandumAddDialog",components:{Editor:m["a"],MemorandumPreviewDrawer:g},props:{memorandumAddDialog:{type:Boolean,default:!1},id:{type:String,default:null}},data:function(){return{menus:["image"],model:{desc:"",tag:[],content:"",contentText:""},inputVisible:!1,inputValue:"",rules:{desc:[{required:!0,message:"事件描述不能为空"}],tag:[{required:!0,message:"事件Tag不能为空",trigger:"blur"}],contentText:[{required:!0,message:"事件内容不能为空"}]},memorandumPreviewDrawer:!1,editorContent:null}},computed:{dialogTitle:function(){return this.id?this.$t("Memerandum.Dialog.Edit.Title"):this.$t("Memerandum.Dialog.Add.Title")}},methods:{addMemorandumListItem:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.post("/addMemorandumListItem",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getMemorandumListItemById:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.get("/getMemorandumListItemById",{params:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),updateMemorandumListItemById:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.post("/updateMemorandumListItemById",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),openDialog:function(){var e=this;this.id?this.getMemorandumListItemById({_id:this.id}).then((function(t){var n=t.data,a=n.status,r=n.result;if(0===a){var i=r.content,s=r.tag,o=r.desc;e.model={content:i,tag:s.split(","),desc:o},e.$refs.editor.editor.txt.html(i),e.model.contentText=e.$refs.editor.editor.txt.text()}})):this.resetModel()},closeDialog:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"function"===typeof e||"boolean"===typeof e&&!e?this.$emit("closeDialog",!1):this.$emit("closeDialog",!0),this.resetModel()},handleClose:function(e){this.model.tag.splice(this.model.tag.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){if(!this.inputVisible)return!1;var e=this.inputValue;e?this.model.tag.includes(e)?this.$message.error("tag 描述不能重复"):this.model.tag.push(e):this.$message.warning("tag 描述不能为空"),this.inputVisible=!1,this.inputValue=""},handlePreview:function(){this.editorContent=this.$refs.editor.editor.txt.html(),this.memorandumPreviewDrawer=!0},closeMemorandumPreview:function(){this.memorandumPreviewDrawer=!1},editorChange:function(e){this.model.contentText=e.txt.text(),this.model.content=e.txt.html()},formatModel:function(){var e=this.model,t=e.desc,n=e.tag,a=e.content;return Object.assign({},{desc:t,tag:n.join(","),content:a})},resetModel:function(){var e=this;this.$nextTick((function(){e.model={desc:"",tag:[],content:"",contentText:""},e.$refs["form"].resetFields(),e.$refs.editor.editor.txt.html(e.model.content),e.model.contentText=e.$refs.editor.editor.txt.text()}))},handleSave:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.id?t.updateMemorandumListItemById(Object.assign({},t.formatModel(),{_id:t.id})).then((function(e){var n=e.data.status;0===n&&t.closeDialog(!0)})):t.addMemorandumListItem(t.formatModel()).then((function(e){var n=e.data.status;0===n&&t.closeDialog(!0)}))}))},tagType:function(e){switch(e){case 0:return"success";case 1:return"";case 2:return"danger";default:}}},created:function(){},mounted:function(){},watch:{}},v=w,M=(n("c7fe"),Object(h["a"])(v,o,u,!1,null,"0ea9e968",null)),b=M.exports,D=n("e966"),T={name:"Memorandum",mixins:[D["a"]],components:{memorandumAddDialog:b,MemorandumPreviewDrawer:g},props:{},data:function(){return{isLoading:!1,list:null,count:0,theTimeRange:null,pickerOptions:{disabledDate:function(e){return e>Date.now()}},params:{page:1,size:20,keyword:null,tag:null,startTime:null,endTime:null},tagEnum:[],memorandumAddDialog:!1,id:null,memorandumPreviewDrawer:!1,editorContent:null}},computed:{timeRange:{get:function(){return this.theTimeRange},set:function(e){e?(this.theTimeRange=e,this.params.startTime=Object(s["a"])(e[0],"yyyy-MM-dd"),this.params.endTime=Object(s["a"])(e[1],"yyyy-MM-dd")):(this.params.startTime=null,this.params.ednTime=null,this.theTimeRange=null)}}},methods:{getMemorandumList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.get("/getMemorandumList",{params:this.params});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getAllTags:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.get("/getAllTags");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),deleteMemorandumListItemById:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.get("/deleteMemorandumListItemById",{params:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),switchMemorandumListItemIsSetFirst:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.post("/switchMemorandumListItemIsSetFirst",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),GETLIST:function(){var e=this;return new Promise((function(t){e.isLoading=!0,e.params.size=e.size,e.params.page=e.page,e.$axios.all([e.getMemorandumList(),e.getAllTags()]).then(e.$axios.spread((function(n,a){var r=n.data.status,i=n.data.result;if(0===r){var s=i.list,o=i.count;e.list=s,e.count=o,e.formatListTag(e.list)}var u=a.data.status,m=a.data.result;0===u&&(e.tagEnum=m),e.isLoading=!1,t()})))}))},formatListTag:function(e){e.map((function(e){return e.tag=e.tag.split(","),e}))},handleAddItem:function(){this.id="",this.memorandumAddDialog=!0},closeDialog:function(e){this.memorandumAddDialog=!1,e&&this.GETLIST()},hanldeCheck:function(e){this.editorContent=e,this.memorandumPreviewDrawer=!0},closeMemorandumPreview:function(){this.editorContent=null,this.memorandumPreviewDrawer=!1},hanldeDelete:function(e){var t=this;this.$confirm(this.$t("Memerandum.Comfirm.Delete.Content"),this.$t("Memerandum.Comfirm.Delete.Tip"),{confirmButtonText:this.$t("Memerandum.Comfirm.Delete.确定"),cancelButtonText:this.$t("Memerandum.Comfirm.Delete.取消"),type:"warning"}).then((function(){t.deleteMemorandumListItemById({_id:e}).then((function(e){var n=e.data.status;0===n&&t.GETLIST().then((function(){t.$message.success(t.$t("Memerandum.刷新列表"))}))}))})).catch((function(){t.$message({type:"info",message:t.$t("Memerandum.Comfirm.Delete.已取消删除")})}))},hanldeEdit:function(e){this.id=e,this.memorandumAddDialog=!0},sureKeyword:function(){this.theTimeRange=null,this.params.startTime=null,this.params.endTime=null,this.params.tag=null,this.GETLIST()},timePickerChange:function(){this.params.keyword=null,this.params.tag=null,this.GETLIST()},tagChange:function(e){this.params.startTime=null,this.params.ednTime=null,this.theTimeRange=null,this.params.keyword=null,e||(this.params.tag=null),this.GETLIST()},tableRowClassName:function(e){var t=e.row;return t.isSetFirst?"is-set-first":""},handleSwitchSetFirst:function(e){var t=this,n=e._id,a=e.isSetFirst;this.$confirm(this.$t("Memerandum.Comfirm.Top.Content"),this.$t("Memerandum.Comfirm.Top.Tip"),{confirmButtonText:this.$t("Memerandum.Comfirm.Top.确定"),cancelButtonText:this.$t("Memerandum.Comfirm.Top.取消"),type:"warning"}).then((function(){t.switchMemorandumListItemIsSetFirst({_id:n,isSetFirst:a}).then((function(e){var n=e.data.status;0===n&&t.GETLIST().then((function(){t.$message.success(t.$t("Memerandum.刷新列表"))}))}))})).catch((function(){t.$message({type:"info",message:t.$t("Memerandum.Comfirm.Top.已取消删除")})}))},tagType:function(e){switch(e){case 0:return"success";case 1:return"";case 2:return"danger";default:}}},created:function(){this.GETLIST()},mounted:function(){},watch:{}},y=T,$=(n("58a8"),Object(h["a"])(y,a,r,!1,null,"65e51f8e",null));t["default"]=$.exports},"93a4":function(e,t,n){},"9e81":function(e,t,n){},bbc7:function(e,t,n){},c7fe:function(e,t,n){"use strict";var a=n("9e81"),r=n.n(a);r.a},f7b6:function(e,t,n){"use strict";var a=n("bbc7"),r=n.n(a);r.a}}]);
//# sourceMappingURL=chunk-e02d4eda.785915a7.js.map